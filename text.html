<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Deedpol Generator</title>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1"/> 
        <meta name="viewport" content="width=device-width" />
        <style>

            @import url('https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed&display=swap');

            ::-moz-selection {
                background: #b3d4fc;
                text-shadow: none;
            }

            ::selection {
                background: #b3d4fc;
                text-shadow: none;
            }

            html {
                padding: 30px 10px;
                font-size: 20px;
                line-height: 1.4;
                color: #737373;
                background: #ecf0f1;
            }

            html {
                padding: 30px 10px;
                font-size: 20px;
                color: #737373;
                background: #ecf0f1;
            }

            body {
                max-width: 500px;
                _width: 500px;
                padding: 30px 20px 50px;
                border: 1px solid #b3b3b3;
                border-radius: 4px;
                margin: 0 auto;
                box-shadow: 0 1px 10px #a7a7a7, inset 0 1px 0 #fff;
                background: #fcfcfc;
            }

            h1 {
                margin: 0 10px;
                font-size: 50px;
                text-align: center;
                font-family: 'Roboto Condensed', sans-serif;
            }

            h3 {
                margin: 1.5em 0 0.5em;
            }

            p {
                margin: 1em 0;
                font-family: 'Roboto', sans-serif;
                text-align: left;
                font-size: 20px;
            }

            ul {
                padding: 0 0 0 40px;
                margin: 1em 0;
            }

            a {
                text-align: center;
                color: #d64937;
            }

            a:hover{
                color: #bbb;
            }

            .container {
                max-width: 400px;
                _width: 380px;
                margin: 0 auto;
            }

            #subjectDetails {
                font-family: 'Roboto', sans-serif;
                text-align: left;
                font-size: 20px;
            }

        </style>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    </head>
    <body>
        <script action="" src="pdftex.js"></script>
        <script action="" src="promisejs/promise.js"></script>
        <div class="container">
            <h1>Deedpol Generator</h1>
            <p>Enter your details and press generate to create your deedpol</p>
            <form id="subjectDetails"  onsubmit="return loadVars()">
                Old name: <br><input type="text" id="oldName"><br>
                New name: <br><input type="text" id="newName"><br>
                Street Address: <br><input type="text" id="streetAddress"><br>
                City: <br><input type="text" id="city"><br>
                County: <br><input type="text" id="county"><br>
                Postcode: <br><input type="text" id="postcode"><br>
                Date: <br><input type="date" id="date"><br>
            <input type="submit" value="Submit" id="submit">
            </form>

        </div>

        <script>
            
            // var visibilityChanger = function(element_id) {
                //   return function(visible) {
                    //     document.getElementById(element_id).style.display = visible ? 'block' : 'none';
                    //   }
                // }
                
                // var showLoadingIndicator = visibilityChanger("running")
                // var showOpenButton = visibilityChanger("tab_open_pdf")
                
                // var appendOutput = function(msg) {
                    //   var content = document.getElementById("output").textContent;
          
                //   var output = document.getElementById("output");
                //   output.textContent = content + "\r\n" + msg;
                
                //   output.scrollTop = 999999;
                //   console.log(msg);
                // }

                var parseTextDate = function(date) {
                    // alert(date)
                    var month = date.getMonth();
                    var day = String(date.getDate());
                    const year = String(date.getFullYear());

                    var suffix = "th";
                    var textMonth = ""

                    if (day == 1 || day == 21 || day == 31) suffix = "st";
                    if (day == 2 || day == 22) suffix = "nd";
                    if (day == 3 || day == 23) suffix = "rd";
                    
                    switch (month) {
                        case 0:
                            textMonth = "January";
                            break;
                        case 1:
                            textMonth = "February";
                            break;
                        case 2:
                            textMonth = "March";
                            break;
                        case 3:
                            textMonth = "April";
                            break;
                        case 4:
                            textMonth = "May";
                            break;
                        case 5:
                            textMonth = "June";
                            break;
                        case 6:
                            textMonth = "July";
                            break;
                        case 7: 
                            textMonth = "August";
                            break;
                        case 8:
                            textMonth = "September";
                            break;
                        case 9:
                            textMonth = "October";
                            break;
                        case 10:
                            textMonth = "November";
                            break;
                        case 11:
                            textMonth = "December";
                    }

                    return `${day}${suffix} day of ${textMonth} in the year ${year}`;
                }
                
                var parseDate = function(date) {
                    // alert(date)
                    var month = String(date.getMonth() + 1);
                    var day = String(date.getDate());
                    const year = String(date.getFullYear());

                    if (month.length < 2) month = '0' + month;
                    if (day.length < 2) day = '0' + day;

                    return `${day}/${month}/${year}`;
                }

                var generateLatex = function(oldName, newName, streetAddress, county, city, postCode, numberDate, textDate) {
                    var latex = 0;
                }

                var logOutput = function(msg) {
                    console.log(msg);
                }
          
                // var pdf_dataurl = undefined;
                // var compile = function(source_code) {
                    // //   document.getElementById("output").textContent = "";
                // //   showLoadingIndicator(true);
                // //   window.location.href = "#running";
                
                //   var pdftex = new PDFTeX();
                //     pdftex.set_TOTAL_MEMORY(80*1024*1024).then(function() {
                //     // pdftex.FS_createLazyFile('/', 'snowden.jpg', 'snowden.jpg', true, true);
                
                //     // pdftex.on_stdout = appendOutput;
                //     // pdftex.on_stderr = appendOutput;
                
                //     // var start_time = new Date().getTime();
          
                //     pdftex.compile(source_code).then(function(pdf_dataurl) {
                    //       var end_time = new Date().getTime();
                    //       console.info("Execution time: " + (end_time-start_time)/1000+' sec');
                    
                //       showLoadingIndicator(false);
                
                //       if(pdf_dataurl === false)
                //         return;
                //       showOpenButton(true);
                //       window.location.href = "#open_pdf";
                //       document.getElementById("open_pdf_btn").focus();
                //     });
                //   });
                // }
                
                // document.getElementById("submit").addEventListener("click", function(e) {
                    //     // var oldName = document.getElementById("oldName").value;
                //     // var newName = document.getElementById("newName");
                //     // var streetAddress = document.getElementById("streetAddress");
                //     // var county = document.getElementById("county");
                //     // var city = document.getElementById("city");
                //     // var postCode = document.getElementById("postcode");
                //     // var date = document.getElementById("date");
                
                //     // console.log(date)
                //     // console.log(oldName)
                
                //     // var numberDate = date;
                //     // var textDate = parseDate(date);
                
                //     // var source_latex = generateLatex(oldName, newName, streetAddress, county, city, postCode, numberDate, textDate);
                //     // compile(source_latex);
                // });
                
                // document.getElementById("open_pdf_btn").addEventListener("click", function(e) {
                //   window.open(pdf_dataurl);
                //   e.preventDefault();
                // });
                
                // var pdftex_preload = new PDFTeX("texlive.js/pdftex-worker.js");
                // pdftex_preload = undefined;
                    
                
                var getLatex = function() {
                    var client = new XMLHttpRequest();
                        client.open('GET', 'https://raw.githubusercontent.com/mavi0/deedpol-template/master/main.tex');
                        client.onreadystatechange = function() {
                            return client.responseText;
                        }
                        client.send();
                }


                
                var pdf_dataurl = undefined;
                function loadVars() {
                    var oldName = document.getElementById("oldName").value;
                    var newName = document.getElementById("newName").value;
                    var streetAddress = document.getElementById("streetAddress").value;
                    var county = document.getElementById("county").value;
                    var date = new Date(document.getElementById("date").value);
                    var postCode = document.getElementById("postcode").value;
                    var city = document.getElementById("city").value;
                    
                    var numberDate = parseDate(date);
                    var textDate = parseTextDate(date);

                    var source_latex = generateLatex(oldName, newName, streetAddress, county, city, postCode, numberDate, textDate);
                    alert(textDate)

                    var pdftex = new PDFTeX();
                    var latex_code = getLatex();
                    console.log(latex_code);
                    
                    pdftex.compile(latex_code).then(function(pdf) { window.open(pdf) }); 
                    pdftex.on_stdout = logOutput;
                    pdftex.on_stderr = logOutput;
                
                }
                var pdftex_preload = new PDFTeX("pdftex-worker.js");
                pdftex_preload = undefined;
              </script>

              <!-- <script>
               // var visibilityChanger = function(element_id) {
                //   return function(visible) {
                //     document.getElementById(element_id).style.display = visible ? 'block' : 'none';
                //   }
                // }
          
                // var showLoadingIndicator = visibilityChanger("running")
                // var showOpenButton = visibilityChanger("tab_open_pdf")
          
                // var appendOutput = function(msg) {
                //   var output = document.getElementById("output");
          
                //   var content = output.textContent;
          
                //   output.textContent = content + "\r\n" + msg;
          
                //   output.scrollTop = 999999;
                //   console.log(msg);
                // }
          
                var pdf_dataurl = undefined;
                var compile = function(source_code) {
                  var source_code = "" +
                              "\\documentclass{article}" +
                              "\\begin{document}" +
                              "\\LaTeX is great!" +
                              "$E = mc^2$" +
                              "\\end{document}";
                //   document.getElementById("output").textContent = "";
                  //showLoadingIndicator(true);
                  window.location.href = "#running";
          
                  var pdftex = new PDFTeX();
                  pdftex.set_TOTAL_MEMORY(80*1024*1024).then(function() {
                    pdftex.FS_createLazyFile('/', 'snowden.jpg', 'snowden.jpg', true, true);
          
                    // pdftex.on_stdout = appendOutput;
                    // pdftex.on_stderr = appendOutput;
          
                    console.time("Execution time");
          
                    pdftex.compile(source_code).then(function(pdf_dataurl) {
                      console.timeEnd("Execution time");
          
                      //showLoadingIndicator(false);
          
                      if (pdf_dataurl === false)
                        return;
          
                      window.open(pdf_dataurl);
                      //showOpenButton(true);
                      window.location.href = "#open_pdf";
                      document.getElementById("open_pdf_btn").focus();
                    });
                  });
                }
          
                document.getElementById("submit").addEventListener("click", function(e) {
                  var source_code = "tty";
                  compile(source_code);
                });
          
                // document.getElementById("open_pdf_btn").addEventListener("click", function(e) {
                //   window.open(pdf_dataurl);
                //   e.preventDefault();
                // });
          
                var pdftex_preload = new PDFTeX("pdftex-worker.js");
                pdftex_preload = undefined;
              </script> -->

              


<!-- <script src="https://togetherjs.com/togetherjs-min.js"></script> -->


</body>
</html>

